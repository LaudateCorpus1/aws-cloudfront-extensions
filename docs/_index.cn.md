---
title: CloudFront Extensions workshop 
chapter: true
---

# Amazon CloudFront Extensions 

Amazon CloudFront Extensions包含覆盖常用用户场景的Lambda@Edge、CloudFront Functions、CDK模版和监控工具，方便用户一站式获取CloudFront拓展功能。本方案部署操作简单，用户可点击下方表格中的Deploy按钮进行部署。

![What is CloudFrontExt](/images/what-is-cloudfrontext.png)

CloudFront Extensions包含三个部分
- 覆盖如下用户场景的Lambda@Edge和CloudFront Function，例如鉴权、预热、根据设备类型跳转、图片缩放
- CDK模块，例如WAF&Shield自动部署模版，用户通过部署此模版可为CloudFront实现DDos、爬虫、XSS、SQL注入等的防御功能
- 监控工具（开发中），通过将CloudFront访问日志或实时日志加载到Amazon Elasticsearch Service，从而在Kibana中展示相应指标，如城市维度的流量使用情况

#### Lambda@Edge

|    **Name**   | **Description**    | **Deployment Type** | **Deploy** |
|------------------|--------------------|----------------|----------------|
| [Authentication by Cognito](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/authentication-with-cognito) | Cognito是亚马逊的鉴权服务，当用户通过Cognito进行鉴权时，本Lambda可验证Cognito返回的token是否合法([Workshop](./deploy/deploy-auth/readme)) | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/authentication-with-cognito), SAM | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/authentication-with-cognito) |
| [Adding security header](https://github.com/awslabs/aws-cloudfront-extensions/blob/main/edge/nodejs/add-security-headers) | Add security header into response after successful authentication, this function will add 'strict-transport-security' to force browser using HTTPS. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/add-security-headers), SAM |  [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/add-security-headers) |
| [Serving Content Based on Device Type](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/serving-based-on-device) | Redirect to the different version of an object based on the type of device that the user is using.([Workshop](./deploy/deploy-device/readme))  | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/serving-based-on-device), SAM | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/serving-based-on-device) |
| [Cross Origin Resource Sharing](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/cross-origin-resource-sharing) | Support CORS(Cross Origin Resource Sharing) by Lambda@Edge. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/cross-origin-resource-sharing), SAM | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/cross-origin-resource-sharing) |
| [Modify response status code](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/modify-response-status-code)  | Modify response status code to specific code, such as 200 to 206, based on configured parameter. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/modify-response-status-code), SAM | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/modify-response-status-code) |
| [Modify response header](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/modify-response-header) | Modify response header as per configuration. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/modify-response-header), SAM, [CDK](https://github.com/pahud/cdk-cloudfront-plus/tree/main/src/demo/modify-response-header) | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/modify-response-header) |
| [Access origin by weight rate](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/access-origin-by-weight-rate) | Forward request to multiple origin regarding to pre-configured weight for each origin.| [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/access-origin-by-weight-rate), SAM | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/access-origin-by-weight-rate) |
| [Failover to alternative origin](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/multiple-origin-IP-retry) | Failover to alternative IP from pre-configured list, return from success IP otherwise retry until last one. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/multiple-origin-IP-retry), SAM, [CDK](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/multiple-origin-IP-retry) | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/multiple-origin-IP-retry) |
| [Support 302 from origin](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/http302-from-origin) | Process 302 response from origin, then access the redirected URL and return the response. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/http302-from-origin), SAM, [CDK](https://github.com/pahud/cdk-cloudfront-plus/issues/12) | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/http302-from-origin) |
| [Pre-warm](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/python/prewarm) | This Lambda will prewarm static content in specific pop. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/prewarm), SAM | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/prewarm) |
| [Resize picture](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/resize-picture) | Resize pictures on the fly according to dimensions passed by the query parameter. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/resize-picture), SAM | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/resize-picture) |
| [Anti-hotlinking](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/anti-hotlinking) | Protect against hotlinking, users need to specify a referer allow list which supports wild card, the request is rejected if the referer is not in the allow list. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/anti-hotlinking), SAM, [CDK](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/anti-hotlinking) | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/anti-hotlinking) |
| [Standardize query string](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/normalize-query-string) | Standardize the query string before CloudFront forwards requests to your origin, so that improve the cache hit ratio. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/normalize-query-string), SAM, [CDK](https://github.com/pahud/cdk-cloudfront-plus/pull/64) | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/normalize-query-string) |
| [OAuth2 Authentication](https://github.com/pahud/cdk-cloudfront-plus/issues/17) | Authentication with OAuth2. | [CDK](https://www.npmjs.com/package/cdk-cloudfront-plus) | - |
| [Authentication with AliYun](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/authentication-with-aliyun-cdn-typeA) | This solution provided by Goclouds Data is designed to achieve ALIYUN CDN authentication. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/authentication-with-aliyun-cdn-typeA), SAM |  [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/authentication-with-aliyun-cdn-typeA) |
| [Default Directory Index for Amazon S3 Origin](https://github.com/pahud/cdk-cloudfront-plus/issues/9) |  re-write the request so that CloudFront requests a default index object (index.html in this case) for any request URI that ends in ‘/’. [Use case](https://aws.amazon.com/tw/blogs/compute/implementing-default-directory-indexes-in-amazon-s3-backed-amazon-cloudfront-origins-using-lambdaedge/) | [CDK](https://www.npmjs.com/package/cdk-cloudfront-plus) | - |
| [Rewrite host for Custom Origin](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/rewrite-url) | Rewrite host for custom origin | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/rewrite-url) |  [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/rewrite-url) |
| [Redirect URL by Geolocation](https://github.com/pahud/cdk-cloudfront-plus/issues/11) | Forward request to the nearest PoP as per geolocation. It will return the location to client for 302 forwarding. | [CDK](https://www.npmjs.com/package/cdk-cloudfront-plus) | - |
| [Convert query string](https://github.com/pahud/cdk-cloudfront-plus/issues/23) | Convert the query string to key & value pairs and add into header. | [CDK](https://www.npmjs.com/package/cdk-cloudfront-plus) | - |
| [Serverless load balancer](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/python/serverless-load-balancer) | The serverless load balance solution will load balance for your origin via Lambda@Edge which is deployed on CloudFront origin request. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/serverless-load-balancer), SAM | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/serverless-load-balancer) |
| [Access origin by geolocation](https://github.com/pahud/cdk-cloudfront-plus/issues/41) | Forward request to the nearest PoP as per geolocation. It will access the location from Edge location. | [CDK](https://www.npmjs.com/package/cdk-cloudfront-plus) | - |
| [Custom Error Page](https://github.com/pahud/cdk-cloudfront-plus/pull/46) | Define a custom error page with a specific status code from the origin response. [Use case](https://aws.amazon.com/blogs/networking-and-content-delivery/customize-403-error-pages-from-amazon-cloudfront-origin-with-lambdaedge/) | [CDK](https://www.npmjs.com/package/cdk-cloudfront-plus) | - |
| [Global Data Ingestion](https://github.com/pahud/cdk-cloudfront-plus/issues/14) | Pipeline custom log to backend data ingestion service like Amazon Kinesis Firehose. [Use case](https://aws.amazon.com/tw/blogs/networking-and-content-delivery/global-data-ingestion-with-amazon-cloudfront-and-lambdaedge/) | [CDK](https://www.npmjs.com/package/cdk-cloudfront-plus) | - |
| [Custom Response with New URL](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/edge/nodejs/custom-response-with-replaced-url) | Replace the response content with a new content. For example, replace the url "www.original.com" to "www.new.com" in the response. | [SAR](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/custom-response-with-replaced-url), SAM | [![部署](/images/deploy_button.png)](https://serverlessrepo.aws.amazon.com/applications/us-east-1/418289889111/custom-response-with-replaced-url) |


#### CloudFront Function
|    **Name**   | **Description**    | **Deploy** |
|------------------|--------------------|----------------|
| [Add Security Headers](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/function/js/add-security-headers) | Add several response headers to enable web browsers security features. | [![部署](/images/deploy_button.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=add-security-headers&templateURL=https:%2F%2Faws-cloudfront-extensions-cff.s3.amazonaws.com%2Fadd-security-headers.yaml) |
| [Cross Origin Resource Sharing](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/function/js/cross-origin-resource-sharing) | Support CORS(Cross Origin Resource Sharing) by CloudFront Function. | [![部署](/images/deploy_button.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=cross-origin-resource-sharing&templateURL=https:%2F%2Faws-cloudfront-extensions-cff.s3.amazonaws.com%2Fcross-origin-resource-sharing.yaml) |
| [Add Cache Control Headers](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/function/js/add-cache-control-header) | Add a Cache-Control header for the browser so that content can be cached locally in the browser. | [![部署](/images/deploy_button.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=add-cache-control-header&templateURL=https:%2F%2Faws-cloudfront-extensions-cff.s3.amazonaws.com%2Fadd-cache-control-header.yaml) |
| [Add Origin Headers](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/function/js/add-origin-header) | Add an Origin header if it is not present in the incoming request. The Origin header is part of [Cross-Origin Resource Sharing](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) (CORS), a mechanism using HTTP headers to tell browsers to give a web application running at one origin access to selected resources from a different origin. | [![部署](/images/deploy_button.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=add-origin-header&templateURL=https:%2F%2Faws-cloudfront-extensions-cff.s3.amazonaws.com%2Fadd-origin-header.yaml) |
| [Add True Client IP Headers](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/function/js/add-true-client-ip-header) | Add a True-Client-IP header to include the IP address of a client connecting to CloudFront. Without this header, connections from CloudFront to your origin contain the IP address of the CloudFront server making the request to your origin, not the IP address of the client connected to CloudFront. | [![部署](/images/deploy_button.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=add-true-client-ip-header&templateURL=https:%2F%2Faws-cloudfront-extensions-cff.s3.amazonaws.com%2Fadd-true-client-ip-header.yaml) |
| [Redirect Based on Country](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/function/js/redirect-based-on-country) | Redirect a user to a country-specific version of a site based on the country of the user. | [![部署](/images/deploy_button.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=redirect-based-on-country&templateURL=https:%2F%2Faws-cloudfront-extensions-cff.s3.amazonaws.com%2Fredirect-based-on-country.yaml) |
| [Default Dir Index](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/function/js/default-dir-index) | Append index.html to the end of URLs that don't include a filename or extension. | [![部署](/images/deploy_button.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=default-dir-index&templateURL=https:%2F%2Faws-cloudfront-extensions-cff.s3.amazonaws.com%2Fdefault-dir-index.yaml) |
| [Verify Json Web Token](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/function/js/verify-jwt) | Validate a JSON Web Token (JWT) in the query string of the incoming request. | [![部署](/images/deploy_button.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=verify-jwt&templateURL=https:%2F%2Faws-cloudfront-extensions-cff.s3.amazonaws.com%2Fverify-jwt.yaml) |
| [Customize Request Host](https://github.com/awslabs/aws-cloudfront-extensions/tree/main/function/js/custom-host) | Replaces host with the value in header awscustomhost. | [![部署](/images/deploy_button.png)](https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=custom-host&templateURL=https:%2F%2Faws-cloudfront-extensions-cff.s3.amazonaws.com%2Fcustom-host.yaml) |

